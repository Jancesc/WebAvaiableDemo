window.__require=function t(o,e,i){function n(c,a){if(!e[c]){if(!o[c]){var s=c.split("/");if(s=s[s.length-1],!o[s]){var u="function"==typeof __require&&__require;if(!a&&u)return u(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+c+"'")}c=s}var l=e[c]={exports:{}};o[c][0].call(l.exports,function(t){return n(o[c][1][t]||t)},l,l.exports,t,o,e,i)}return e[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<i.length;c++)n(i[c]);return n}({Test:[function(t,o,e){"use strict";cc._RF.push(o,"d1ea53aLRNMDrA5bw+9aNYa","Test");var i,n=this&&this.__extends||(i=function(t,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])})(t,o)},function(t,o){function e(){this.constructor=t}i(t,o),t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}),r=this&&this.__decorate||function(t,o,e,i){var n,r=arguments.length,c=r<3?o:null===i?i=Object.getOwnPropertyDescriptor(o,e):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,o,e,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(r<3?n(c):r>3?n(o,e,c):n(o,e))||c);return r>3&&c&&Object.defineProperty(o,e,c),c};Object.defineProperty(e,"__esModule",{value:!0});var c=cc._decorator,a=c.ccclass,s=c.property,u=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.audioClip=null,o.restoreButton=null,o.autoRestoringTip=null,o.playingAudioMap={},o.backgroundTime=0,o}return n(o,t),o.prototype.onLoad=function(){cc.game.on(cc.game.EVENT_SHOW,this.handleGameShow,this),cc.game.on(cc.game.EVENT_HIDE,this.handleGameHide,this),this.initUI()},o.prototype.initUI=function(){this.restoreButton&&(this.restoreButton.active=!1,this.restoreButton.on(cc.Node.EventType.TOUCH_END,this.onRestoreButtonClick,this)),this.autoRestoringTip&&(this.autoRestoringTip.active=!1)},o.prototype.play=function(){var t=this;if(!this.audioClip)return-1;var o=cc.audioEngine.playEffect(this.audioClip,!1);return cc.audioEngine.setVolume(o,1),this.playingAudioMap[o]={clip:this.audioClip,time:0,loop:!1,volume:1},cc.audioEngine.setFinishCallback(o,function(){console.log("\u97f3\u9891\u64ad\u653e\u5b8c\u6210:",o),delete t.playingAudioMap[o]}),console.log("\u97f3\u9891\u64ad\u653e\u5f00\u59cb, ID:",o),o},o.prototype.handleGameHide=function(){for(var t in console.log("\u5e94\u7528\u8fdb\u5165\u540e\u53f0"),this.backgroundTime=Date.now(),this.playingAudioMap)try{var o=cc.audioEngine.getCurrentTime(parseInt(t));this.playingAudioMap[t].time=o,console.log("\u4fdd\u5b58\u97f3\u9891"+t+"\u7684\u64ad\u653e\u4f4d\u7f6e: "+o)}catch(e){console.error("\u65e0\u6cd5\u4fdd\u5b58\u97f3\u9891"+t+"\u7684\u72b6\u6001:",e)}},o.prototype.handleGameShow=function(){var t=this;console.log("\u5e94\u7528\u56de\u5230\u524d\u53f0");var o=Date.now()-this.backgroundTime;console.log("\u5728\u540e\u53f0\u505c\u7559\u4e86 "+(o/1e3).toFixed(1)+" \u79d2"),cc.sys.os===cc.sys.OS_IOS&&(this.autoRestoringTip&&(this.autoRestoringTip.active=!0,this.scheduleOnce(function(){t.autoRestoringTip&&(t.autoRestoringTip.active=!1)},3)),this.rebuildAudioContext(),this.playActivationSound(),Object.keys(this.playingAudioMap).length>0&&this.scheduleOnce(function(){t.tryAutoRestore()},.5))},o.prototype.tryAutoRestore=function(){var t=this;if(0!==Object.keys(this.playingAudioMap).length){console.log("\u5c1d\u8bd5\u81ea\u52a8\u6062\u590d\u97f3\u9891..."),this.playActivationSound();var o=!1,e={},i=function(t){try{var i=n.playingAudioMap[t],r=cc.audioEngine.playEffect(i.clip,i.loop);console.log("\u91cd\u65b0\u521b\u5efa\u97f3\u9891 "+t+" -> "+r),cc.audioEngine.setVolume(r,i.volume),i.time>0&&setTimeout(function(){try{cc.audioEngine.setCurrentTime(r,i.time)}catch(t){}},100),e[t]=r,o=!0}catch(c){console.error("\u6062\u590d\u97f3\u9891"+t+"\u5931\u8d25:",c)}},n=this;for(var r in this.playingAudioMap)i(r);if(o){this.playingAudioMap={};var c=function(o){var i=e[o],n=a.playingAudioMap[o];a.playingAudioMap[i]={clip:n.clip,time:n.time,loop:n.loop,volume:n.volume},cc.audioEngine.setFinishCallback(i,function(){console.log("\u97f3\u9891\u64ad\u653e\u5b8c\u6210:",i),delete t.playingAudioMap[i]})},a=this;for(var s in e)c(s);console.log("\u81ea\u52a8\u6062\u590d\u6210\u529f!"),this.restoreButton&&(this.restoreButton.active=!1)}else console.warn("\u81ea\u52a8\u6062\u590d\u5931\u8d25\uff0c\u663e\u793a\u624b\u52a8\u6062\u590d\u6309\u94ae"),this.restoreButton?(this.restoreButton.active=!0,this.scheduleOnce(function(){t.restoreButton&&(t.restoreButton.active=!1)},10)):this.createSimpleRestoreButton()}},o.prototype.createSimpleRestoreButton=function(){var t=this,o=new cc.Node("RestoreButton");o.width=300,o.height=100,o.addComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame;var e=new cc.Node("Label"),i=e.addComponent(cc.Label);i.string="\u70b9\u51fb\u6062\u590d\u97f3\u9891",i.fontSize=30,e.parent=o,o.parent=cc.director.getScene(),o.x=cc.winSize.width/2,o.y=cc.winSize.height/2,o.on(cc.Node.EventType.TOUCH_END,this.onRestoreButtonClick,this),this.restoreButton=o,this.scheduleOnce(function(){o.isValid&&(o.removeFromParent(),t.restoreButton=null)},10)},o.prototype.onRestoreButtonClick=function(){var t=this;console.log("\u7528\u6237\u70b9\u51fb\u6062\u590d\u6309\u94ae"),this.restoreButton&&(this.restoreButton.active=!1),this.rebuildAudioContext(),this.playActivationSound(),this.scheduleOnce(function(){t.tryAutoRestore()},.2)},o.prototype.rebuildAudioContext=function(){try{var t=cc.sys,o=t.__audioSupport.context;if(o){console.log("\u65e7AudioContext\u72b6\u6001:",o.state);try{o.close&&o.close()}catch(i){console.error("\u5173\u95ed\u65e7AudioContext\u5931\u8d25:",i)}}var e=window.AudioContext||window.webkitAudioContext;return e?(t.__audioSupport.context=new e,console.log("\u65b0AudioContext\u5df2\u521b\u5efa\uff0c\u72b6\u6001:",t.__audioSupport.context.state),!0):(console.error("\u4e0d\u652f\u6301AudioContext"),!1)}catch(i){return console.error("\u91cd\u5efaAudioContext\u5931\u8d25:",i),!1}},o.prototype.playActivationSound=function(){try{var t=cc.sys.__audioSupport.context;if(!t)return void console.warn("\u627e\u4e0d\u5230AudioContext");var o=t.createOscillator(),e=t.createGain();e.gain.value=.001,o.connect(e),e.connect(t.destination),o.frequency.value=200,o.start(),setTimeout(function(){try{o.stop()}catch(t){}},50),console.log("\u5df2\u64ad\u653e\u6fc0\u6d3b\u58f0\u97f3")}catch(i){console.error("\u64ad\u653e\u6fc0\u6d3b\u58f0\u97f3\u5931\u8d25:",i)}},o.prototype.onDestroy=function(){cc.game.off(cc.game.EVENT_SHOW,this.handleGameShow,this),cc.game.off(cc.game.EVENT_HIDE,this.handleGameHide,this);try{cc.audioEngine.stopAll()}catch(t){}},r([s(cc.AudioClip)],o.prototype,"audioClip",void 0),r([s(cc.Node)],o.prototype,"restoreButton",void 0),r([s(cc.Node)],o.prototype,"autoRestoringTip",void 0),r([a],o)}(cc.Component);e.default=u,cc._RF.pop()},{}]},{},["Test"]);
//# sourceMappingURL=index.js.map
